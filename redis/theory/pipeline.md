# 管道

## redis默认的请求方式

当我们使用客户端对 Redis 进行一次操作时，如下图所示，客户端将请求传送给服务器，服务器处理完毕后，再将响应回复给客户端。这要花费一个网络数据包来回的时间。 

![](../../.gitbook/assets/image%20%2827%29.png)

如果连续执行多条指令，那就会花费多个网络数据包来回的时间。如下图所示：

 

![](../../.gitbook/assets/image%20%2824%29.png)

客户端是经历了写-读-写-读四个操作才完整地执行了两条指令。 

![](../../.gitbook/assets/image%20%2823%29.png)

调整读写顺序，改成 写—写-读-读，这两个指令同样可以正常完成。 

![](../../.gitbook/assets/image%20%2826%29.png)

两个连续的写操作和两个连续的读操作总共只会花费一次网络来回，就好比连续的 write 操作合并了，连续的 read 操作也合并了一样。 

![](../../.gitbook/assets/image%20%2822%29.png)

这便是管道操作的作用，服务器根本没有任何区别对待，还是收到一条消息，执行一条消息，回复一条消息的正常的流程。客户端通过对管道中的指令列表改变读写顺序就可以大幅节省 IO 时间。在cpu极限范围内管道中指令越多，效果越好。 

